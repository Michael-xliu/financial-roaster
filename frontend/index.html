<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Financial Roaster - Get Brutally Roasted ðŸ”¥</title>
  <meta name="description" content="Upload your bank statement and get brutally roasted by AI - the financial reality check you need ðŸ”¥">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Roast Theme Variables */
    :root {
      --primary-color: #ff4444;
      --primary-dark: #cc0000;
      --secondary-color: #ff6b35;
      --accent-color: #ffaa44;
      --text-primary: #ffffff;
      --text-secondary: #cccccc;
      --text-muted: #999999;
      --bg-primary: #1a0f0f;
      --bg-secondary: #2d1616;
      --bg-card: #3d2020;
      --border-color: #5d3030;
      --shadow-color: rgba(255, 68, 68, 0.3);
      --upload-bg: #2d1616;
      --upload-border: #5d3030;
      --upload-hover: #3d2020;
      --gradient: linear-gradient(135deg, #ff4444, #ff6b35);

      --font-primary: 'Inter', system-ui, -apple-system, sans-serif;
      --font-mono: 'JetBrains Mono', 'Courier New', monospace;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-primary);
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow-x: hidden;
    }

    .container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      position: relative;
    }

    /* Animated Background */
    .bg-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      opacity: 0.05;
    }

    .bg-animation::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: var(--gradient);
      animation: rotate 20s linear infinite;
      border-radius: 50%;
    }

    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .main-card {
      background: var(--bg-card);
      border-radius: 24px;
      padding: 2.5rem;
      box-shadow: 0 25px 50px var(--shadow-color), 0 0 0 1px var(--border-color);
      max-width: 600px;
      width: 100%;
      position: relative;
      z-index: 1;
      backdrop-filter: blur(20px);
      border: 1px solid var(--border-color);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .logo {
      width: 80px;
      height: 80px;
      margin: 0 auto 1.5rem;
      background: var(--gradient);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .title {
      font-size: 2.5rem;
      font-weight: 800;
      background: var(--gradient);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
    }

    .subtitle {
      color: var(--text-secondary);
      font-size: 1.125rem;
      font-weight: 400;
      max-width: 400px;
      margin: 0 auto;
      line-height: 1.6;
    }


    /* Upload Area */
    .upload-area {
      border: 2px dashed var(--upload-border);
      border-radius: 16px;
      padding: 3rem 2rem;
      text-align: center;
      background: var(--upload-bg);
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 2rem 0;
      position: relative;
      overflow: hidden;
    }

    .upload-area:hover {
      border-color: var(--primary-color);
      background: var(--upload-hover);
      transform: translateY(-2px);
    }

    .upload-area.dragover {
      border-color: var(--primary-color);
      background: var(--primary-color);
      background-opacity: 0.1;
      transform: scale(1.02);
    }

    .upload-icon {
      font-size: 3rem;
      color: var(--primary-color);
      margin-bottom: 1rem;
      display: block;
    }

    .upload-text {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .upload-hint {
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    .file-input {
      display: none;
    }

    /* Progress Bar */
    .progress-container {
      margin: 2rem 0;
      display: none;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--bg-secondary);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 1rem;
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient);
      width: 0%;
      transition: width 0.3s ease;
      position: relative;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .progress-text {
      text-align: center;
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    /* Action Button */
    .action-btn {
      width: 100%;
      padding: 1rem 2rem;
      background: var(--gradient);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.125rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .action-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px var(--shadow-color);
    }

    .action-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* Results Area */
    .results {
      margin-top: 2rem;
      display: none;
    }

    .results.show {
      display: block;
      animation: slideUp 0.5s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .result-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .result-icon {
      font-size: 1.5rem;
    }

    .result-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .advice-container {
      background: var(--bg-secondary);
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid var(--border-color);
      font-family: var(--font-mono);
      line-height: 1.7;
      white-space: pre-wrap;
      font-size: 0.95rem;
      position: relative;
      overflow: hidden;
    }

    .typing-cursor {
      display: inline-block;
      width: 2px;
      height: 1.2em;
      background: var(--primary-color);
      margin-left: 2px;
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    /* File Info */
    .file-info {
      background: var(--bg-secondary);
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
      display: none;
      border: 1px solid var(--border-color);
    }

    .file-info.show {
      display: block;
    }

    .file-name {
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .file-size {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    /* Responsive Design */
    @media (max-width: 640px) {
      .main-card {
        padding: 1rem;
        margin: 0.5rem;
      }

      .title {
        font-size: 1.75rem;
      }

      .subtitle {
        font-size: 0.95rem;
      }

      .upload-area {
        padding: 1.5rem 1rem;
      }

      .upload-icon {
        font-size: 2rem;
      }

      .upload-text {
        font-size: 1rem;
      }

      .mode-btn {
        padding: 0.75rem 1rem;
        font-size: 0.9rem;
      }

      .action-btn {
        font-size: 1rem;
        padding: 0.875rem 1.5rem;
      }

      .chaos-label {
        font-size: 0.8rem;
        letter-spacing: 1px;
      }
    }

    /* Error State */
    .error {
      color: #ef4444;
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
      font-size: 0.9rem;
    }

    /* Success State */
    .success {
      color: #22c55e;
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
      font-size: 0.9rem;
    }

    /* Loading Animation */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Share Cards Section */
    .share-section {
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 1px solid var(--border-color);
      animation: slideUp 0.5s ease;
    }

    .share-header {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .share-header h3 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .share-header p {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .card-formats {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      background: var(--bg-secondary);
      padding: 0.25rem;
      border-radius: 12px;
      border: 1px solid var(--border-color);
    }

    .format-btn {
      flex: 1;
      padding: 0.75rem 1rem;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 500;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .format-btn.active {
      background: var(--gradient);
      color: white;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px var(--shadow-color);
    }

    .format-btn i {
      font-size: 1rem;
    }

    .card-preview {
      background: var(--bg-secondary);
      border-radius: 16px;
      padding: 1rem;
      margin-bottom: 1.5rem;
      border: 1px solid var(--border-color);
      display: flex;
      justify-content: center;
      overflow: hidden;
    }

    #roast-canvas {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }

    /* ===== PREMIUM FLIP CARD ===== */
    .flip-card-container {
      perspective: 1000px;
      width: 320px;
      height: 450px;
    }

    .flip-card {
      position: relative;
      width: 100%;
      height: 100%;
      cursor: pointer;
      transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      transform-style: preserve-3d;
    }

    .flip-card.flipped {
      transform: rotateY(180deg);
    }

    .flip-card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
    }

    .flip-card-front,
    .flip-card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 20px;
      overflow: hidden;
      box-shadow:
        0 20px 40px rgba(0, 0, 0, 0.15),
        0 10px 20px rgba(0, 0, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .flip-card-back {
      transform: rotateY(180deg);
    }

    .card-gradient {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        135deg,
        #ff4444 0%,
        #ff6b35 25%,
        #ff8c42 50%,
        #ffaa44 75%,
        #ff6b35 100%
      );
      opacity: 1;
    }

    .card-content {
      position: relative;
      z-index: 2;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 2rem 1.5rem;
      color: white;
      text-align: center;
    }

    .card-header {
      font-size: 1.1rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 2px;
      opacity: 0.95;
    }

    .chaos-score-display {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .chaos-number {
      font-size: 5.5rem;
      font-weight: 900;
      line-height: 0.9;
      text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      margin-bottom: 0.5rem;
      background: linear-gradient(45deg, #ffffff, #fff3e0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .chaos-label {
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 3px;
      opacity: 0.9;
      text-transform: uppercase;
    }

    .card-subtitle {
      font-size: 0.85rem;
      opacity: 0.8;
      font-weight: 500;
      animation: subtle-pulse 2s ease-in-out infinite;
    }

    @keyframes subtle-pulse {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 0.95; }
    }

    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.75rem;
      opacity: 0.8;
      font-weight: 500;
    }

    .roast-text {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      line-height: 1.6;
      font-weight: 500;
      text-align: center;
      padding: 1rem 0;
    }

    .mini-score {
      font-weight: 700;
    }

    /* Ultra-premium shine effect */
    .card-shine {
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.4) 50%,
        transparent 100%
      );
      transform: skewX(-25deg);
      transition: left 0.6s ease;
      z-index: 3;
    }

    .flip-card:hover .card-shine {
      left: 100%;
    }

    /* Hover effects */
    .flip-card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow:
        0 25px 50px rgba(0, 0, 0, 0.2),
        0 15px 30px rgba(0, 0, 0, 0.15);
    }

    .flip-card.flipped:hover {
      transform: rotateY(180deg) translateY(-5px) scale(1.02);
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
      .flip-card-container {
        width: 280px;
        height: 400px;
      }

      .chaos-number {
        font-size: 4.5rem;
      }

      .card-content {
        padding: 1.5rem 1rem;
      }
    }

    .share-actions {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 0.75rem;
    }

    .share-btn {
      padding: 0.75rem 1rem;
      border: 1px solid var(--border-color);
      background: var(--bg-secondary);
      color: var(--text-primary);
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .share-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px var(--shadow-color);
      border-color: var(--primary-color);
    }

    .download-btn {
      background: var(--gradient);
      color: white;
      border-color: transparent;
    }

    .share-btn i {
      font-size: 0.9rem;
    }

    /* Random Sample Section */
    .random-sample-section {
      margin: 2rem 0;
      text-align: center;
    }

    .random-sample-btn {
      background: var(--gradient);
      border: none;
      border-radius: 12px;
      padding: 1rem 2rem;
      color: white;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin: 0 auto 1.5rem auto;
      box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
    }

    .random-sample-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 107, 53, 0.4);
    }

    .random-sample-btn:active {
      transform: scale(0.98);
    }

    .random-sample-btn i {
      font-size: 1.2rem;
    }

    .sample-info {
      margin-top: 0.75rem;
    }

    .sample-info-toggle {
      background: transparent;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 0.5rem 1rem;
      color: var(--text-secondary);
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 0 auto;
      width: fit-content;
    }

    .sample-info-toggle:hover {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border-color: var(--primary-color);
    }

    .sample-info-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease-in-out, opacity 0.3s ease;
      margin-top: 1rem;
      opacity: 0;
    }

    .sample-info-content.show {
      max-height: 600px;
      opacity: 1;
    }

    .personality-preview {
      background: var(--bg-secondary);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 0 auto;
      max-width: 500px;
      border: 1px solid var(--border-color);
    }

    .personality-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 1.5rem;
      text-align: left;
    }

    .personality-item:last-child {
      margin-bottom: 0;
    }

    .personality-emoji {
      font-size: 1.5rem;
      flex-shrink: 0;
      width: 2rem;
    }

    .personality-details strong {
      color: var(--text-primary);
      font-size: 0.95rem;
      display: block;
      margin-bottom: 0.25rem;
    }

    .personality-details p {
      color: var(--text-secondary);
      font-size: 0.85rem;
      margin: 0;
      line-height: 1.4;
    }

    .spending-snapshot {
      margin-top: 0.5rem;
      font-size: 0.75rem;
      color: var(--text-muted);
      line-height: 1.3;
    }

    .spending-snapshot .amount {
      color: var(--primary-color);
      font-weight: 600;
      font-family: var(--font-mono);
    }

    .sample-note {
      color: var(--text-muted);
      font-size: 0.85rem;
      margin: 1rem 0 0 0;
      text-align: center;
      font-style: italic;
    }

    .sample-info-icon {
      transition: transform 0.3s ease;
    }

    .sample-info-icon.rotated {
      transform: rotate(180deg);
    }

    /* Transaction Preview */
    .transaction-preview {
      margin: 1.5rem 0;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      max-height: 0;
      overflow: hidden;
    }

    .transaction-preview.show {
      opacity: 1;
      transform: translateY(0);
      max-height: 600px;
    }

    .transaction-preview-content {
      background: var(--bg-secondary);
      border-radius: 16px;
      padding: 2rem;
      border: 1px solid var(--border-color);
      margin: 0 auto;
      max-width: 500px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2), 0 0 0 1px var(--border-color);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    /* Add subtle gradient overlay */
    .transaction-preview-content::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: var(--gradient);
      opacity: 0.6;
    }

    .preview-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
      color: var(--text-primary);
      font-weight: 600;
      font-size: 1rem;
      text-align: center;
      justify-content: center;
    }

    .preview-header i {
      color: var(--primary-color);
      font-size: 1.1rem;
      animation: pulse 2s infinite;
    }

    .transaction-list {
      display: grid;
      gap: 0.75rem;
    }

    .transaction-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: var(--bg-card);
      border-radius: 12px;
      border: 1px solid rgba(255, 68, 68, 0.15);
      animation: fadeInUp 0.4s ease;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .transaction-item:hover {
      transform: translateY(-1px);
      border-color: rgba(255, 68, 68, 0.3);
      box-shadow: 0 4px 12px rgba(255, 68, 68, 0.1);
    }

    .transaction-item:nth-child(1) { animation-delay: 0.1s; }
    .transaction-item:nth-child(2) { animation-delay: 0.2s; }
    .transaction-item:nth-child(3) { animation-delay: 0.3s; }
    .transaction-item:nth-child(4) { animation-delay: 0.4s; }
    .transaction-item:nth-child(5) { animation-delay: 0.5s; }

    @keyframes fadeInUp {
      0% {
        opacity: 0;
        transform: translateY(20px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .transaction-merchant {
      color: var(--text-primary);
      font-weight: 600;
      font-size: 0.95rem;
    }

    .transaction-amount {
      color: var(--primary-color);
      font-weight: 700;
      font-family: var(--font-mono);
      font-size: 1rem;
    }

    .transaction-memo {
      color: var(--text-secondary);
      font-size: 0.8rem;
      margin-top: 0.25rem;
      font-style: italic;
      line-height: 1.3;
    }

    .transaction-details {
      text-align: left;
      flex: 1;
    }

    /* Roast Sample Button styles removed - no longer needed */

    @media (max-width: 640px) {
      .transaction-preview-content {
        padding: 1.5rem;
        margin: 0 0.5rem;
      }

      .transaction-item {
        padding: 0.75rem;
      }

      .transaction-merchant,
      .transaction-amount {
        font-size: 0.9rem;
      }
    }

    /* Manual Input Section */
    .manual-input-section {
      margin: 2rem 0;
    }

    .section-divider {
      text-align: center;
      margin: 2rem 0 1.5rem 0;
      position: relative;
    }

    .section-divider::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 1px;
      background: var(--border-color);
    }

    .divider-text {
      background: var(--bg-card);
      color: var(--text-secondary);
      padding: 0 1rem;
      font-size: 0.9rem;
      font-weight: 500;
      position: relative;
      z-index: 1;
    }

    .manual-input-title {
      color: var(--text-primary);
      font-size: 1.1rem;
      font-weight: 600;
      text-align: center;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .manual-input-title i {
      color: var(--primary-color);
    }

    .manual-input-container {
      background: var(--bg-secondary);
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid var(--border-color);
    }

    .manual-spending-input {
      width: 100%;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 1rem;
      color: var(--text-primary);
      font-family: var(--font-primary);
      font-size: 0.9rem;
      line-height: 1.5;
      resize: vertical;
      min-height: 120px;
      transition: border-color 0.3s ease;
    }

    .manual-spending-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(255, 68, 68, 0.1);
    }

    .manual-spending-input::placeholder {
      color: var(--text-muted);
      opacity: 1;
    }

    .input-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 1rem;
      gap: 1rem;
    }

    .character-counter {
      color: var(--text-secondary);
      font-size: 0.75rem;
      font-family: var(--font-mono);
    }

    .manual-roast-btn {
      background: var(--gradient);
      border: none;
      border-radius: 8px;
      padding: 0.75rem 1.5rem;
      color: white;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 2px 8px rgba(255, 68, 68, 0.2);
    }

    .manual-roast-btn:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(255, 68, 68, 0.3);
    }

    .manual-roast-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    @media (max-width: 640px) {
      .random-sample-btn {
        font-size: 1rem;
        padding: 0.875rem 1.5rem;
      }

      .personality-preview {
        padding: 1rem;
      }

      .personality-item {
        gap: 0.75rem;
      }

      .manual-input-container {
        padding: 1rem;
      }

      .input-footer {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
      }

      .manual-roast-btn {
        align-self: stretch;
        justify-content: center;
      }
    }

    /* Mobile optimization for phones */
    @media (max-width: 640px) {
      .share-actions {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }

      .format-btn {
        font-size: 0.8rem;
        padding: 0.6rem 0.8rem;
      }

      #roast-canvas {
        width: 280px;
        height: 280px;
      }
    }

    /* Extra small mobile screens */
    @media (max-width: 480px) {
      .main-card {
        padding: 0.75rem;
        margin: 0.25rem;
      }

      .title {
        font-size: 1.5rem;
      }

      .subtitle {
        font-size: 0.9rem;
      }

      .logo {
        width: 60px;
        height: 60px;
        font-size: 1.5rem;
      }

      .flip-card-container {
        width: 250px;
        height: 350px;
      }

      .chaos-number {
        font-size: 3.5rem;
      }

      .manual-input-title {
        font-size: 1rem;
      }

      .personality-item {
        flex-direction: column;
        text-align: center;
        gap: 0.5rem;
      }

      .personality-emoji {
        font-size: 2rem;
      }

      .desktop-only {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="bg-animation"></div>

  <div class="container">
    <div class="main-card">
      <header class="header">
        <div class="logo">
          <i class="fas fa-fire-flame-curved" id="logo-icon"></i>
        </div>
        <h1 class="title">Financial Roaster</h1>
        <p class="subtitle">
          Upload your bank statement and get brutally roasted ðŸ”¥
        </p>
      </header>

      <!-- Upload Area -->
      <div class="upload-area" id="upload-area">
        <i class="fas fa-cloud-upload-alt upload-icon"></i>
        <div class="upload-text">Drop your financial statement here</div>
        <div class="upload-hint">or click to browse â€¢ CSV, PDF, JPEG, PNG supported</div>
        <input type="file" class="file-input" id="file-input" accept=".csv,.pdf,.jpg,.jpeg,.png">
      </div>

      <!-- File Info -->
      <div class="file-info" id="file-info">
        <div class="file-name" id="file-name"></div>
        <div class="file-size" id="file-size"></div>
      </div>

      <!-- Action Button -->
      <button class="action-btn" id="action-btn" disabled>
        <span id="btn-text">Select a file to continue</span>
        <div class="loading" id="loading" style="display: none;"></div>
      </button>

      <!-- Random Sample Section -->
      <div class="random-sample-section" id="random-sample-section">
        <div class="section-divider">
          <span class="divider-text">or try a sample</span>
        </div>

        <button class="random-sample-btn" id="random-sample-btn">
          <i class="fas fa-dice"></i>
          <span>Generate Random Sample</span>
        </button>

        <!-- Transaction Preview (shows briefly when sample is selected) -->
        <div class="transaction-preview" id="transaction-preview">
          <div class="transaction-preview-content">
            <div class="preview-header">
              <i class="fas fa-receipt"></i>
              <span>Analyzing these transactions...</span>
            </div>
            <div class="transaction-list" id="transaction-list">
              <!-- Transactions will be populated by JavaScript -->
            </div>
          </div>
        </div>
      </div>

      <!-- Manual Input Section -->
      <div class="manual-input-section" id="manual-input-section">
        <div class="section-divider">
          <span class="divider-text">or</span>
        </div>

        <h3 class="manual-input-title">
          <i class="fas fa-keyboard"></i>
          Type Your Spending Manually
        </h3>

        <div class="manual-input-container">
          <textarea
            id="manual-spending-input"
            class="manual-spending-input"
            placeholder="Tell me what you spent this month...

Examples:
â€¢ $150 on DoorDash because I'm too lazy to cook
â€¢ $89 on that thing I saw on TikTok and will never use
â€¢ $45 Starbucks visits (don't judge me)
â€¢ $200 on clothes I didn't need
â€¢ $300 rent, $67 groceries, $234 on random Amazon stuff

Be honest about your financial disasters... ðŸ’¸"
            rows="6"
            maxlength="2000"></textarea>

          <div class="input-footer">
            <div class="character-counter">
              <span id="char-count">0</span>/2000 characters
            </div>
            <button class="manual-roast-btn" id="manual-roast-btn" disabled>
              <i class="fas fa-fire"></i>
              <span>Roast My Spending</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Progress -->
      <div class="progress-container" id="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text" id="progress-text">Analyzing your spending...</div>
      </div>

      <!-- Results -->
      <div class="results" id="results">
        <div class="result-header">
          <i class="result-icon fas fa-fire"></i>
          <span class="result-title">Your Financial Roasting</span>
        </div>
        <div class="advice-container">
          <div id="advice-text"></div>
          <span class="typing-cursor" id="cursor" style="display: none;"></span>
        </div>

        <!-- Share Cards Section -->
        <div class="share-section" id="share-section" style="display: none;">
          <div class="share-header">
            <h3>ðŸ“± Share Your Roast</h3>
            <p>Turn your financial roast into viral content!</p>
          </div>

          <div class="card-formats">
            <button class="format-btn active" data-format="instagram">
              <i class="fab fa-instagram"></i>
              Instagram
            </button>
            <button class="format-btn" data-format="twitter">
              <i class="fab fa-twitter"></i>
              Twitter
            </button>
            <button class="format-btn" data-format="tiktok">
              <i class="fab fa-tiktok"></i>
              TikTok
            </button>
          </div>

          <div class="card-preview">
            <div class="flip-card-container" id="flip-card-container">
              <div class="flip-card" id="flip-card">
                <div class="flip-card-inner" id="flip-card-inner">
                  <!-- Front: Chaos Score -->
                  <div class="flip-card-front">
                    <div class="card-gradient"></div>
                    <div class="card-content">
                      <div class="card-header">ðŸ”¥ FINANCIAL ROASTER</div>
                      <div class="chaos-score-display">
                        <div class="chaos-number" id="chaos-number">87</div>
                        <div class="chaos-label">FINANCIAL CHAOS SCORE</div>
                      </div>
                      <div class="card-subtitle">Click to reveal your roast</div>
                      <div class="card-footer">FinancialRoaster.app</div>
                    </div>
                    <div class="card-shine"></div>
                  </div>

                  <!-- Back: Roast Text -->
                  <div class="flip-card-back">
                    <div class="card-gradient"></div>
                    <div class="card-content">
                      <div class="card-header">ðŸ”¥ YOUR ROAST</div>
                      <div class="roast-text" id="roast-text">
                        Your financial decisions are more chaotic than a cryptocurrency market crash...
                      </div>
                      <div class="card-footer">
                        <div class="mini-score desktop-only">Financial Chaos: <span id="mini-chaos">87</span>/100</div>
                        <div>FinancialRoaster.app</div>
                      </div>
                    </div>
                    <div class="card-shine"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Hidden canvas for download functionality -->
            <canvas id="roast-canvas" width="1080" height="1080" style="display: none;"></canvas>
          </div>

          <div class="share-actions">
            <button class="share-btn download-btn" id="download-btn">
              <i class="fas fa-download"></i>
              Download Image
            </button>
            <button class="share-btn" id="share-btn">
              <i class="fas fa-share"></i>
              Share
            </button>
            <button class="share-btn copy-btn" id="copy-link-btn">
              <i class="fas fa-link"></i>
              Copy Link
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // UI state management
    let currentFile = null;
    let isProcessing = false;

    // DOM elements
    const uploadArea = document.getElementById('upload-area');
    const fileInput = document.getElementById('file-input');
    const fileInfo = document.getElementById('file-info');
    const fileName = document.getElementById('file-name');
    const fileSize = document.getElementById('file-size');
    const progressContainer = document.getElementById('progress-container');
    const progressFill = document.getElementById('progress-fill');
    const progressText = document.getElementById('progress-text');
    const actionBtn = document.getElementById('action-btn');
    const btnText = document.getElementById('btn-text');
    const loading = document.getElementById('loading');
    const results = document.getElementById('results');
    const adviceText = document.getElementById('advice-text');
    const cursor = document.getElementById('cursor');
    const randomSampleBtn = document.getElementById('random-sample-btn');
    const randomSampleSection = document.getElementById('random-sample-section');
    const transactionPreview = document.getElementById('transaction-preview');
    const transactionList = document.getElementById('transaction-list');

    // Manual input elements
    const manualSpendingInput = document.getElementById('manual-spending-input');
    const charCount = document.getElementById('char-count');
    const manualRoastBtn = document.getElementById('manual-roast-btn');

    // Sample Files Management
    let availableSamples = [];

    async function loadSampleFiles() {
      try {
        const response = await fetch('/samples');
        const data = await response.json();
        availableSamples = data.samples;
        console.log('Loaded', availableSamples.length, 'sample personalities');

        // Show the random sample section since we have samples
        randomSampleSection.style.display = 'block';
      } catch (error) {
        console.error('Failed to load sample files:', error);
        randomSampleSection.style.display = 'none';
      }
    }

    // Random sample selection
    function getRandomSample() {
      if (availableSamples.length === 0) return null;
      const randomIndex = Math.floor(Math.random() * availableSamples.length);
      return availableSamples[randomIndex];
    }

    // Sample info toggle functionality removed - no longer needed

    // Transaction preview functions
    function getSampleTransactions(sampleId) {
      const sampleData = {
        'tech_bro': [
          { merchant: 'Soylent', amount: 15.99, memo: 'Meal replacement for productivity' },
          { merchant: 'Apple Store', amount: 299.99, memo: 'AirPods Max for focus' },
          { merchant: 'WeWork', amount: 450.00, memo: 'Hot desk membership' },
          { merchant: 'Patagonia', amount: 199.99, memo: 'Startup uniform vest' }
        ],
        'college_student': [
          { merchant: '7-Eleven', amount: 3.50, memo: 'Instant ramen dinner' },
          { merchant: 'Amazon', amount: 45.00, memo: 'Textbook I will never open' },
          { merchant: 'Netflix', amount: 8.99, memo: 'Procrastination fuel' },
          { merchant: 'Uber Eats', amount: 35.00, memo: 'Too lazy to walk to cafeteria' }
        ],
        'impulse_shopper': [
          { merchant: 'Amazon', amount: 89.99, memo: 'Thing I saw in TikTok ad' },
          { merchant: 'Target', amount: 234.50, memo: 'Went for shampoo, bought everything' },
          { merchant: 'QVC', amount: 129.99, memo: 'Limited time offer panic buy' },
          { merchant: 'Best Buy', amount: 199.99, memo: 'Gadget I will use once' }
        ],
        'coffee_addict': [
          { merchant: 'Starbucks', amount: 6.45, memo: 'New Year resolution lasted 1 hour' },
          { merchant: 'Starbucks', amount: 12.99, memo: 'Venti with 5 shots' },
          { merchant: 'Blue Bottle', amount: 15.99, memo: 'Fancy single origin' },
          { merchant: 'Nespresso', amount: 89.99, memo: 'Home setup to save money (lol)' }
        ]
      };
      return sampleData[sampleId] || [];
    }

    let currentSampleId = null; // Store the current sample ID for processing

    function showTransactionPreview(transactions, sampleId = null) {
      console.log('=== showTransactionPreview START ===');
      console.log('Transactions received:', transactions);
      console.log('Sample ID:', sampleId);
      console.log('transactionList element:', transactionList);
      console.log('transactionPreview element:', transactionPreview);

      if (!transactionList || !transactionPreview) {
        console.error('Required elements not found!', {transactionList, transactionPreview});
        return;
      }

      // Store the sample ID for later processing
      currentSampleId = sampleId;

      // Clear previous transactions
      transactionList.innerHTML = '';
      console.log('Cleared previous transactions');

      // Create transaction items
      transactions.forEach((transaction, index) => {
        const item = document.createElement('div');
        item.className = 'transaction-item';
        item.innerHTML = `
          <div class="transaction-details">
            <div class="transaction-merchant">${transaction.merchant}</div>
            ${transaction.memo ? `<div class="transaction-memo">${transaction.memo}</div>` : ''}
          </div>
          <div class="transaction-amount">$${transaction.amount.toFixed(2)}</div>
        `;
        transactionList.appendChild(item);
        console.log(`Added transaction ${index + 1}:`, transaction.merchant, `$${transaction.amount}`);
      });

      console.log('Total transaction items in DOM:', transactionList.children.length);

      // Show the preview
      transactionPreview.classList.add('show');
      console.log('Added "show" class to transaction preview');

      // Check after adding show class
      setTimeout(() => {
        console.log('After adding "show" class:');
        console.log('- classList:', transactionPreview.className);
        console.log('- computed display:', window.getComputedStyle(transactionPreview).display);
        console.log('- computed opacity:', window.getComputedStyle(transactionPreview).opacity);
        console.log('- computed maxHeight:', window.getComputedStyle(transactionPreview).maxHeight);
        console.log('- element visible:', transactionPreview.offsetHeight > 0);
        console.log('=== showTransactionPreview END ===');
      }, 100);
    }

    function hideTransactionPreview() {
      console.log('=== hideTransactionPreview called ===');
      console.log('Before removing show class:', transactionPreview.className);
      transactionPreview.classList.remove('show');
      console.log('After removing show class:', transactionPreview.className);
      console.log('=== hideTransactionPreview END ===');
    }

    function resetUI() {
      // Reset all UI elements to default state
      results.style.display = 'none';
      progressContainer.style.display = 'none';
      progressFill.style.width = '0%';
      progressText.textContent = 'Analyzing your spending...';
      actionBtn.disabled = true;
      btnText.textContent = 'Select a file to continue';
      loading.style.display = 'none';
      isProcessing = false;

      // Hide transaction preview and clear sample ID
      hideTransactionPreview();
      currentSampleId = null;

      // Hide share section if it exists
      const shareSection = document.querySelector('.share-section');
      if (shareSection) {
        shareSection.style.display = 'none';
      }

      // Clear all personal data and reset file input
      currentFile = null;
      fileInput.value = '';
      hideFileInfo();
      hideError();

      // Clear manual input
      manualSpendingInput.value = '';
      updateCharCount();

      // Clear stored results data for privacy
      currentAdvice = '';
      currentChaosScore = 50;

      // Clear advice text and canvas
      if (adviceText) adviceText.innerHTML = '';
      if (roastCanvas) {
        const ctx = roastCanvas.getContext('2d');
        ctx.clearRect(0, 0, roastCanvas.width, roastCanvas.height);
      }
    }

    async function selectSample(sampleId) {
      console.log('=== selectSample START ===');
      console.log('Sample ID:', sampleId);
      console.log('isProcessing:', isProcessing);

      if (isProcessing) {
        console.log('Already processing, returning early');
        return;
      }

      // Show transaction preview first
      const transactions = getSampleTransactions(sampleId);
      console.log('Got transactions for preview:', transactions.length, 'transactions');
      console.log('Calling showTransactionPreview...');
      showTransactionPreview(transactions, sampleId);

      // Auto-start processing after a brief delay to let user see the transactions
      console.log('Setting 2 second delay before auto-starting roast...');
      setTimeout(() => {
        // Only start processing if we haven't been interrupted by another action
        if (currentSampleId === sampleId && !isProcessing) {
          console.log('Auto-starting roast generation for sample:', sampleId);
          startSampleProcessing(sampleId);
        } else {
          console.log('Sample processing cancelled or changed, not auto-starting');
        }
      }, 2000); // Show transactions for 2 seconds before auto-starting

      console.log('=== selectSample END (preview shown, auto-start scheduled) ===');
    }

    // New function to start processing the sample (auto-called after showing preview)
    async function startSampleProcessing(sampleId) {
      console.log('=== startSampleProcessing START ===');
      console.log('Sample ID:', sampleId);

      if (isProcessing) {
        console.log('Already processing, returning early');
        return;
      }

      // DON'T hide transaction preview - keep it visible during processing
      // DON'T call resetUI - we want to keep the preview showing

      // Set up processing UI elements
      console.log('Setting up processing UI while keeping preview visible...');
      fileInfo.style.display = 'none';
      progressContainer.style.display = 'block';
      actionBtn.style.display = 'block';
      actionBtn.disabled = true;
      btnText.textContent = 'Roasting this financial disaster...';
      loading.style.display = 'inline-block';

      // Clear any previous results
      results.style.display = 'none';
      const shareSection = document.querySelector('.share-section');
      if (shareSection) {
        shareSection.style.display = 'none';
      }

      // Add processing visual feedback
      progressFill.style.width = '30%';
      progressText.textContent = 'Loading sample financial profile...';

      setTimeout(() => {
        progressFill.style.width = '60%';
        progressText.textContent = 'Preparing the roast...';
      }, 500);

      setTimeout(() => {
        progressFill.style.width = '90%';
        progressText.textContent = 'Getting ready to destroy your spending habits...';
      }, 1000);

      // Start the actual analysis
      console.log('Starting performSampleAnalysis...');
      performSampleAnalysis(sampleId);

      console.log('=== startSampleProcessing END ===');
    }

    async function performSampleAnalysis(sampleId) {
      isProcessing = true;

      try {
        const response = await fetch(`/analyze-sample/${sampleId}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });

        if (!response.ok) {
          throw new Error('Failed to analyze sample');
        }

        const result = await response.json();

        // Complete progress
        progressFill.style.width = '100%';
        progressText.textContent = 'Roast complete!';

        setTimeout(() => {
          displayResults(result.advice, result.chaos_score || 50);
        }, 500);

      } catch (error) {
        console.error('Sample analysis failed:', error);
        progressFill.style.width = '0%';
        progressText.textContent = 'Analysis failed - please try again';
        actionBtn.disabled = false;
        btnText.textContent = 'Try Again';
        loading.style.display = 'none';
      } finally {
        isProcessing = false;
      }
    }

    // File handling
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function showFileInfo(file) {
      currentFile = file;
      fileName.textContent = file.name;
      fileSize.textContent = formatFileSize(file.size);
      fileInfo.classList.add('show');

      actionBtn.disabled = false;
      btnText.textContent = 'Roast My Finances!';
    }

    function hideFileInfo() {
      currentFile = null;
      fileInfo.classList.remove('show');
      actionBtn.disabled = true;
      btnText.textContent = 'Select a file to continue';
    }

    // Drag and drop functionality
    uploadArea.addEventListener('click', () => {
      // Reset UI and clear all data when upload area is clicked
      if (results.style.display === 'block' || results.classList.contains('show')) {
        resetUI();
      } else {
        // Hide transaction preview if it's showing
        hideTransactionPreview();
        currentSampleId = null;
      }
      fileInput.click();
    });

    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');

      const files = e.dataTransfer.files;
      if (files.length > 0) {
        handleFileSelect(files[0]);
      }
    });

    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        handleFileSelect(e.target.files[0]);
      }
    });

    function handleFileSelect(file) {
      const allowedTypes = ['text/csv', 'application/pdf', 'image/jpeg', 'image/png'];

      if (!allowedTypes.includes(file.type)) {
        showError('Please select a CSV, PDF, JPEG, or PNG file.');
        return;
      }

      if (file.size > 50 * 1024 * 1024) { // 50MB limit
        showError('File size must be less than 50MB.');
        return;
      }

      showFileInfo(file);
      hideError();
    }

    // Progress handling
    function showProgress() {
      progressContainer.style.display = 'block';
      progressFill.style.width = '0%';
    }

    function updateProgress(percent, text) {
      progressFill.style.width = percent + '%';
      progressText.textContent = text;
    }

    function hideProgress() {
      progressContainer.style.display = 'none';
    }

    // Error handling
    function showError(message) {
      hideError();
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error';
      errorDiv.textContent = message;
      uploadArea.parentNode.insertBefore(errorDiv, uploadArea.nextSibling);
    }

    function hideError() {
      const existingError = document.querySelector('.error');
      if (existingError) {
        existingError.remove();
      }
    }

    // Results display with typewriter effect
    function showResults(advice, chaosScore = 50) {
      console.log('showResults called with:', advice?.substring(0, 50) + '...', 'chaos score:', chaosScore);

      // Clear all loading states first
      progressContainer.style.display = 'none';
      actionBtn.disabled = true;
      btnText.textContent = 'Select a file to continue';
      loading.style.display = 'none';
      isProcessing = false;

      // Get the result elements
      const resultIcon = document.querySelector('.result-icon');
      const resultTitle = document.querySelector('.result-title');

      console.log('Elements found:', { resultIcon, resultTitle, results });

      // Set default roast styling (keeping existing content)
      if (resultIcon) {
        resultIcon.className = 'result-icon fas fa-fire';
      }
      if (resultTitle) {
        resultTitle.textContent = 'Your Financial Roasting';
      }

      console.log('Adding show class to results');

      // Force display block to override any inline styles
      results.style.display = 'block';
      results.classList.add('show');

      console.log('Results classes after adding show:', results.className);
      console.log('Results computed display:', window.getComputedStyle(results).display);

      // Typewriter effect
      console.log('Starting typewriter effect with advice:', advice?.substring(0, 50) + '...');
      console.log('adviceText element:', adviceText);
      console.log('cursor element:', cursor);

      try {
        adviceText.innerHTML = '';
        console.log('Cleared adviceText');

        let i = 0;
        const speed = 30; // typing speed in milliseconds

        function typeWriter() {
          try {
            if (i < advice.length) {
              const currentText = advice.substring(0, i + 1);
              adviceText.innerHTML = currentText + '<span class="typing-cursor"></span>';
              i++;
              setTimeout(typeWriter, speed);
            } else {
              console.log('Typewriter complete, removing cursor');
              adviceText.innerHTML = advice;
              // Show share section after typewriter completes
              setTimeout(() => {
                console.log('Showing share section');
                showShareSection(advice, chaosScore);
              }, 1000);
            }
          } catch (error) {
            console.error('Error in typeWriter:', error);
          }
        }

        console.log('Starting typewriter with 500ms delay');
        setTimeout(typeWriter, 500);
      } catch (error) {
        console.error('Error setting up typewriter:', error);
      }
    }

    // Alias for compatibility with sample analysis
    function displayResults(advice, chaosScore = 50) {
      console.log('displayResults called with advice length:', advice?.length, 'chaos score:', chaosScore);

      // Hide progress container first
      const progressContainer = document.getElementById('progress-container');
      if (progressContainer) {
        progressContainer.style.display = 'none';
        console.log('Progress container hidden');
      }

      // Now hide the transaction preview since we're showing the final results
      if (transactionPreview.classList.contains('show')) {
        console.log('Hiding transaction preview as roast is complete');
        hideTransactionPreview();
        currentSampleId = null;
      }

      showResults(advice, chaosScore);
    }

    // API call
    async function analyzeFile() {
      if (!currentFile || isProcessing) return;

      isProcessing = true;
      actionBtn.disabled = true;
      btnText.style.display = 'none';
      loading.style.display = 'inline-block';

      showProgress();
      updateProgress(10, 'Uploading file...');

      try {
        const formData = new FormData();
        formData.append('file', currentFile);
        formData.append('tone', 'roast');

        updateProgress(30, 'Processing document...');

        const response = await fetch('/upload', {
          method: 'POST',
          body: formData
        });

        updateProgress(70, 'Generating advice...');

        if (!response.ok) {
          const error = await response.json().catch(() => ({}));
          throw new Error(error.detail || `Server error: ${response.status}`);
        }

        const data = await response.json();
        updateProgress(100, 'Complete!');

        setTimeout(() => {
          hideProgress();
          showResults(data.advice || 'No advice available.');
        }, 500);

      } catch (error) {
        console.error('Error:', error);
        hideProgress();
        showError('Error: ' + error.message);
      } finally {
        isProcessing = false;
        actionBtn.disabled = false;
        btnText.style.display = 'inline';
        loading.style.display = 'none';
      }
    }

    // Share card elements
    const shareSection = document.getElementById('share-section');
    const formatButtons = document.querySelectorAll('.format-btn');
    const roastCanvas = document.getElementById('roast-canvas');
    const flipCard = document.getElementById('flip-card');
    const flipCardInner = document.getElementById('flip-card-inner');
    const chaosNumber = document.getElementById('chaos-number');
    const roastText = document.getElementById('roast-text');
    const miniChaos = document.getElementById('mini-chaos');
    const downloadBtn = document.getElementById('download-btn');
    const shareBtn = document.getElementById('share-btn');
    const copyLinkBtn = document.getElementById('copy-link-btn');

    let currentAdvice = '';
    let currentChaosScore = 50;
    let currentFormat = 'instagram';
    let isFlipped = false;

    // Flip card functionality
    function setupFlipCard() {
      if (flipCard) {
        flipCard.addEventListener('click', () => {
          isFlipped = !isFlipped;
          flipCard.classList.toggle('flipped', isFlipped);
        });
      }
    }

    // Update card content
    function updateFlipCard(advice, chaosScore) {
      if (chaosNumber) chaosNumber.textContent = chaosScore;
      if (miniChaos) miniChaos.textContent = chaosScore;
      if (roastText) roastText.textContent = advice;

      // Reset to front side when new content is loaded
      isFlipped = false;
      if (flipCard) flipCard.classList.remove('flipped');
    }

    // Card generation functions
    function generateRoastCard(advice, format, chaosScore = 50) {
      const canvas = roastCanvas;
      const ctx = canvas.getContext('2d');

      // Set canvas dimensions based on format
      const dimensions = {
        instagram: { width: 1080, height: 1080 },
        twitter: { width: 1200, height: 675 },
        tiktok: { width: 1080, height: 1920 }
      };

      const dim = dimensions[format];
      canvas.width = dim.width;
      canvas.height = dim.height;

      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Create roast gradient background
      const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
      gradient.addColorStop(0, '#ff4444');
      gradient.addColorStop(0.5, '#ff6b35');
      gradient.addColorStop(1, '#ffaa44');

      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Add subtle overlay pattern
      ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
      for (let i = 0; i < canvas.width; i += 100) {
        for (let j = 0; j < canvas.height; j += 100) {
          ctx.fillRect(i, j, 1, 50);
          ctx.fillRect(i, j, 50, 1);
        }
      }

      // Set text properties
      ctx.fillStyle = 'white';
      ctx.textAlign = 'center';

      // Header
      const headerSize = Math.floor(canvas.width / 18);
      ctx.font = `bold ${headerSize}px Inter, system-ui, sans-serif`;
      const headerText = 'ðŸ”¥ FINANCIAL ROASTER';
      ctx.fillText(headerText, canvas.width / 2, headerSize + 40);

      // FINANCIAL CHAOS SCORE - Big prominent number
      const chaosSize = Math.floor(canvas.width / 8);
      ctx.font = `bold ${chaosSize}px Inter, system-ui, sans-serif`;
      ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
      ctx.fillText(chaosScore.toString(), canvas.width / 2, headerSize + 140);

      // Financial Chaos label
      const chaosLabelSize = Math.floor(canvas.width / 28); // Slightly smaller to fit longer text
      ctx.font = `${chaosLabelSize}px Inter, system-ui, sans-serif`;
      ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
      ctx.fillText('FINANCIAL CHAOS SCORE', canvas.width / 2, headerSize + 175);

      // Reset text color for advice
      ctx.fillStyle = 'white';

      // Main advice text
      const maxWidth = canvas.width - 120;
      const lineHeight = Math.floor(canvas.width / 24);
      const adviceSize = Math.floor(canvas.width / 22);
      ctx.font = `${adviceSize}px Inter, system-ui, sans-serif`;

      // Word wrap the advice
      const words = advice.split(' ');
      const lines = [];
      let currentLine = '';

      for (let i = 0; i < words.length; i++) {
        const testLine = currentLine + words[i] + ' ';
        const metrics = ctx.measureText(testLine);
        const testWidth = metrics.width;

        if (testWidth > maxWidth && currentLine !== '') {
          lines.push(currentLine);
          currentLine = words[i] + ' ';
        } else {
          currentLine = testLine;
        }
      }
      lines.push(currentLine);

      // Draw advice text (adjust position to account for chaos score)
      const chaosSpaceUsed = headerSize + 200; // Header + chaos score + labels
      const availableSpace = canvas.height - chaosSpaceUsed - 120; // Leave space at bottom too
      const startY = chaosSpaceUsed + (availableSpace - lines.length * lineHeight) / 2;
      for (let i = 0; i < lines.length; i++) {
        ctx.fillText(lines[i], canvas.width / 2, startY + (i * lineHeight));
      }

      // Footer
      const footerSize = Math.floor(canvas.width / 30);
      ctx.font = `${footerSize}px Inter, system-ui, sans-serif`;
      ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
      ctx.fillText('Get your financial roast at FinancialRoaster.app', canvas.width / 2, canvas.height - 60);

      // Logo/icon
      const iconSize = Math.floor(canvas.width / 25);
      ctx.font = `${iconSize}px Inter, system-ui, sans-serif`;
      ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
      ctx.fillText('ðŸ”¥', canvas.width / 2, canvas.height - 20);
    }

    function showShareSection(advice, chaosScore = 50) {
      currentAdvice = advice;
      currentChaosScore = chaosScore;
      shareSection.style.display = 'block';

      // Update the flip card with new content
      updateFlipCard(advice, chaosScore);

      // Still generate canvas in background for download functionality
      generateRoastCard(advice, currentFormat, chaosScore);

      // Scroll to share section
      setTimeout(() => {
        shareSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 300);
    }

    // Format button handlers (for download functionality)
    formatButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        formatButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFormat = btn.dataset.format;
        // Regenerate canvas in background for downloads
        generateRoastCard(currentAdvice, currentFormat, currentChaosScore);
      });
    });

    // Download handler
    downloadBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = `financial-roaster-${currentFormat}-${Date.now()}.png`;
      link.href = roastCanvas.toDataURL();
      link.click();
    });

    // Share handler (Web Share API)
    shareBtn.addEventListener('click', async () => {
      if (navigator.share) {
        try {
          const canvas = roastCanvas;
          canvas.toBlob(async (blob) => {
            const file = new File([blob], `financial-roaster-${currentFormat}.png`, { type: 'image/png' });
            await navigator.share({
              title: 'My Financial Roasting',
              text: 'Check out my brutally honest financial roast!',
              files: [file]
            });
          });
        } catch (error) {
          console.log('Error sharing:', error);
          // Fallback to download
          downloadBtn.click();
        }
      } else {
        // Fallback to download
        downloadBtn.click();
      }
    });

    // Copy link handler
    copyLinkBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(window.location.href);

        // Show success feedback
        const originalText = copyLinkBtn.innerHTML;
        copyLinkBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
        copyLinkBtn.style.background = 'var(--gradient)';
        copyLinkBtn.style.color = 'white';

        setTimeout(() => {
          copyLinkBtn.innerHTML = originalText;
          copyLinkBtn.style.background = '';
          copyLinkBtn.style.color = '';
        }, 2000);
      } catch (error) {
        console.log('Failed to copy link');
      }
    });

    // Integrate share section into the original showResults function
    // (The share section will be shown automatically after typewriter effect)

    // Action button event listener
    actionBtn.addEventListener('click', analyzeFile);

    // Random sample button event listener
    randomSampleBtn.addEventListener('click', () => {
      // Reset UI and clear all data when random sample is clicked after results
      if (results.style.display === 'block' || results.classList.contains('show')) {
        resetUI();
      } else {
        // Hide any existing transaction preview before showing new one
        hideTransactionPreview();
        currentSampleId = null;
      }

      const randomSample = getRandomSample();
      if (randomSample) {
        console.log('Random sample selected:', randomSample.id);
        selectSample(randomSample.id);
      } else {
        console.error('No samples available');
      }
    });

    // Sample info toggle event listener (removed - no longer needed)

    // Manual input functionality
    function updateCharCount() {
      const length = manualSpendingInput.value.length;
      charCount.textContent = length;

      // Enable/disable button based on input
      const hasContent = length > 10; // Require at least 10 characters
      manualRoastBtn.disabled = !hasContent;
    }

    async function analyzeManualSpending() {
      if (isProcessing) return;

      const spendingText = manualSpendingInput.value.trim();
      if (!spendingText || spendingText.length < 10) return;

      // Show loading state - first clear any existing results and data
      resetUI();

      // Restore the manual input text (since resetUI clears it)
      manualSpendingInput.value = spendingText;
      updateCharCount();
      progressContainer.style.display = 'block';
      actionBtn.style.display = 'block';
      actionBtn.disabled = true;
      btnText.textContent = 'Roasting your financial disasters...';
      loading.style.display = 'inline-block';

      // Progress animation
      progressFill.style.width = '30%';
      progressText.textContent = 'Parsing your spending confessions...';

      setTimeout(() => {
        progressFill.style.width = '60%';
        progressText.textContent = 'Preparing brutal honesty...';
      }, 500);

      setTimeout(() => {
        progressFill.style.width = '90%';
        progressText.textContent = 'Crafting your roast...';
      }, 1000);

      isProcessing = true;

      try {
        const response = await fetch('/analyze-manual', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            spending_text: spendingText,
            tone: 'roast'
          })
        });

        if (!response.ok) {
          throw new Error('Failed to analyze manual spending');
        }

        const result = await response.json();

        // Complete progress
        progressFill.style.width = '100%';
        progressText.textContent = 'Roast complete!';

        setTimeout(() => {
          displayResults(result.advice, result.chaos_score || 50);
        }, 500);

      } catch (error) {
        console.error('Manual analysis failed:', error);
        progressFill.style.width = '0%';
        progressText.textContent = 'Analysis failed - please try again';
        actionBtn.disabled = false;
        btnText.textContent = 'Try Again';
        loading.style.display = 'none';
      } finally {
        isProcessing = false;
      }
    }

    // Manual input event listeners
    manualSpendingInput.addEventListener('input', () => {
      updateCharCount();
      // Hide transaction preview when user starts typing manually
      if (transactionPreview.classList.contains('show')) {
        hideTransactionPreview();
        currentSampleId = null;
      }
    });

    manualSpendingInput.addEventListener('focus', () => {
      // Also hide on focus in case user clicks into the field
      if (transactionPreview.classList.contains('show')) {
        hideTransactionPreview();
        currentSampleId = null;
      }
    });

    manualRoastBtn.addEventListener('click', analyzeManualSpending);

    // Initialize the app
    document.addEventListener('DOMContentLoaded', () => {
      loadSampleFiles();
      setupFlipCard();
    });
  </script>
</body>
</html>